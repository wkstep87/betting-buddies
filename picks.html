<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Picks ¬∑ NFL Picks</title>

  <link rel="stylesheet" href="assets/styles.css"/>

  <!-- Libraries & project config (order matters) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
  <script src="assets/config.js"></script>
  <script src="assets/supabase.js"></script>
  <script src="assets/common.js"></script>
</head>

<body>
<header>
  <div class="nav">
    <div class="brand">
      <img src="assets/BB1_clean_transparent_optimized.png" alt="Betting Buddies" class="brand-logo">
    </div>

    <nav class="nav-links">
      <a href="picks.html">Picks</a>
      <a href="group.html">Group</a>
      <a href="standings.html">Standings</a>
      <a href="bankroll.html">Bankroll</a>
    </nav>

    <div class="spacer"></div>
    <span class="badge">Season 2025</span>
  </div>
</header>

<main>
  <div class="card">
    <div class="toolbar">
      <div>
        <label>Username:
          <input id="username" type="text" value="Will" style="width:140px"/>
        </label>
      </div>
      <div>
        <label>Week:
          <select id="week-select" class="select"></select>
        </label>
      </div>
      <div class="lock">
        <button class="btn admin" id="btn-set-current-week" style="display:none" title="Make this the default week on load">Default Week</button>
        <button class="btn admin" id="btn-freeze-week" style="display:none" title="Freeze all current lines for this week">‚ùÑÔ∏è Freeze Week</button>
        <button class="btn admin" id="btn-lock" style="display:none" title="Lock this week so no picks can be edited">üîí Lock Week</button>
        <button class="btn admin" id="btn-unlock" style="display:none" title="Unlock this week to allow edits">üîì Unlock Week</button>
      </div>
    </div>

    <div class="table-wrap">
      <table id="picks-table" class="table picks">
        <thead>
          <tr>
            <th>Matchup</th>
            <th>Home Spread</th>
            <th>Your Pick</th>
            <th>Confidence</th>
          </tr>
        </thead>
        <tbody id="picks-body"></tbody>
      </table>
    </div>

    <!-- Partial progress banner -->
    <div id="partialWarning" class="partial-note" style="display:none; margin:10px 0;">
      Your slate is partially complete. <span id="partialCount"></span>
    </div>

    <!-- Footer bar with Save on the right -->
    <div id="footer-bar" style="display:flex; justify-content:space-between; align-items:center; margin-top:20px;">
      <div id="dupWarning"></div>
      <div id="footer-note">
        Confidence starts at 16 and descends; lowest numbers removed if fewer games.
      </div>
      <div>
        <button id="savePicksBtn" class="btn btn-primary">Save Picks</button>
        <span id="saveStatus" style="margin-left:10px; display:none;"></span>
      </div>
    </div>
  </div>
</main>

<div class="toast"></div>

<!-- BB:PICKS:TOP5_CONFIRM_START -->
<!-- Confirm Modal -->
<div id="confirmModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:1000;">
  <div style="max-width:640px; margin:80px auto; background:#111; color:#eee; border-radius:8px; padding:16px;">
    <h3 style="margin:0 0 10px;">Confirm Picks ‚Äî Top 5 by Confidence</h3>
    <div id="confirmSummary" style="font-size:14px; opacity:0.9; margin-bottom:10px;"></div>
    <div id="top5List" style="border:1px solid #333; border-radius:6px; padding:8px; max-height:300px; overflow:auto;"></div>
    <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:12px;">
      <button id="cancelConfirmBtn" class="btn">Cancel</button>
      <button id="confirmSaveBtn" class="btn btn-primary">Confirm</button>
    </div>
  </div>
</div>
<!-- BB:PICKS:TOP5_CONFIRM_END -->

<!-- Page logic -->
<script>
  // -----------------------
  // Page state & helpers
  // -----------------------
  let CURRENT_WEEK = 1;
  let locked = false;
  let games = [];
  let myPicks = {};               // { [gameId]: { team, confidence } }
  let usedConfidence = new Set(); // Set<number>

  function localConfValuesForGames(n) {
    return Array.from({ length: n }, (_, i) => 16 - i);
  }

  function setUsername(u) {
    USERNAME = (u.trim() || 'Will');
    localStorage.setItem('username', USERNAME);
    // Show admin controls if Will
    const isAdmin = (USERNAME === 'Will');
    document.getElementById('btn-lock').style.display          = isAdmin ? 'inline-block' : 'none';
    document.getElementById('btn-unlock').style.display        = isAdmin ? 'inline-block' : 'none';
    document.getElementById('btn-freeze-week').style.display   = isAdmin ? 'inline-block' : 'none';
    document.getElementById('btn-set-current-week').style.display = isAdmin ? 'inline-block' : 'none';
  }

  // -----------------------
  // Init & render
  // -----------------------
  async function init() {
    // username
    const u = localStorage.getItem('username') || window.CONFIG.USERNAME || 'Will';
    document.getElementById('username').value = u;
    setUsername(u);

    // week select
    const weeks = await sbLoadWeeks();
    const sel = document.getElementById('week-select');
    sel.innerHTML = '';
    weeks.forEach(w => {
      const o = document.createElement('option');
      o.value = w.week;
      o.textContent = 'Week ' + w.week;
      sel.appendChild(o);
    });

    // try season default, else fall back to first week
    const defaultWeek = await sbGetCurrentWeek();
    CURRENT_WEEK = (Number.isFinite(defaultWeek) && weeks.some(w => w.week === defaultWeek))
      ? defaultWeek
      : (weeks[0]?.week || 1);
    sel.value = CURRENT_WEEK;

    sel.onchange = () => { CURRENT_WEEK = Number(sel.value); render(); };
    document.getElementById('username').onchange = (e) => setUsername(e.target.value);

    // Admin buttons
    document.getElementById('btn-lock').onclick = async () => { await adminLock(CURRENT_WEEK, 'lock'); await render(); };
    document.getElementById('btn-unlock').onclick = async () => { await adminLock(CURRENT_WEEK, 'unlock'); await render(); };
    document.getElementById('btn-freeze-week').onclick = async () => { await sbFreezeWeek(CURRENT_WEEK); await render(); };
    document.getElementById('btn-set-current-week').onclick = async () => {
      await sbSetCurrentWeek(CURRENT_WEEK);
      showToast(`Default week set to ${CURRENT_WEEK}`);
    };

    await render();
    updatePartialBanner();
    initSaveFlow();
  }

  // Abbreviations
  const IS_MOBILE = window.matchMedia('(max-width: 768px)');
  function teamAbbr(name) {
    const map = (window.TEAM_LOGOS || window.TEAM_ABBR || {});
    if (map[name]) return map[name];
    const initials = name.split(/\s+/).map(w => w[0]).join('');
    return (initials || name).slice(0, 3).toUpperCase();
  }
  function applyLabelMode(sel, mode) {
    Array.from(sel.options).forEach(opt => {
      const full = opt.dataset.full || opt.textContent;
      const abbr = opt.dataset.abbr || full;
      opt.textContent = (mode === 'abbr') ? abbr : full;
    });
  }

  // -----------------------
  // Duplicate confidence helpers
  // -----------------------
  function updateDuplicateWarnings() {
    const allConfSelects = Array.from(document.querySelectorAll('select.conf'));
    allConfSelects.forEach(s => s.classList.remove('duplicate'));

    const counts = {};
    allConfSelects.forEach(sel => {
      const v = sel.value;
      if (v) (counts[v] ||= []).push(sel);
    });

    const dupes = [];
    Object.entries(counts).forEach(([val, sels]) => {
      if (sels.length > 1) {
        dupes.push(val);
        sels.forEach(s => s.classList.add('duplicate'));
      }
    });

    const bar = document.getElementById('dupWarning');
    if (!bar) return;
    if (dupes.length > 0) {
      bar.style.display = 'block';
      bar.textContent = `Duplicate confidence values used: ${dupes.join(', ')}`;
    } else {
      bar.style.display = 'none';
      bar.textContent = '';
    }
  }

  async function render() {
    locked  = await sbLoadWeekLock(CURRENT_WEEK);
    games   = await sbLoadGames(CURRENT_WEEK);
    myPicks = await sbLoadMyPicks(CURRENT_WEEK);

    // safety sort by kickoff time
    games.sort((a,b) => {
      const ta = a.commence_time ? new Date(a.commence_time).getTime() : Infinity;
      const tb = b.commence_time ? new Date(b.commence_time).getTime() : Infinity;
      if (ta !== tb) return ta - tb;
      return String(a.id).localeCompare(String(b.id));
    });

    usedConfidence = new Set(
      Object.values(myPicks)
        .map(p => (p.confidence != null ? Number(p.confidence) : undefined))
        .filter(Boolean)
    );

    const tbody = document.getElementById('picks-body');
    tbody.innerHTML = '';

    const confPool = localConfValuesForGames(games.length);

    games.forEach(g => {
      const tr = document.createElement('tr');
      tr.setAttribute('data-game-id', g.id);
      tr.setAttribute('data-home', g.home);
      tr.setAttribute('data-away', g.away);
      tr.setAttribute('data-spread', (g.spread ?? '').toString());

      // Matchup cell
      const tdM = document.createElement('td');

      // Desktop-only kickoff label above matchup
      const ko = document.createElement('div');
      ko.className = 'kickoff-tag hide-mobile';
      if (g.commence_time) {
        const dt = new Date(g.commence_time);
        ko.textContent = dt.toLocaleString('en-US', {
          weekday: 'short',
          hour: 'numeric',
          minute: '2-digit'
        });
      } else {
        ko.textContent = '';
      }
      tdM.appendChild(ko);

      const row = document.createElement('div');
      row.className = 'row-team matchup-grid';

      const awayDiv = document.createElement('div');
      awayDiv.className = 'matchup-away';
      const awayName = document.createElement('span');
      awayName.className = 'team-name';
      awayName.textContent = g.away + ' ';
      awayDiv.appendChild(awayName);
      awayDiv.appendChild(makeTeamLogoOnly(g.away));

      const at = document.createElement('div');
      at.textContent = '@';
      at.style.textAlign = 'center';

      const homeDiv = document.createElement('div');
      homeDiv.className = 'matchup-home';
      const homeLogo = makeTeamLogoOnly(g.home);
      const homeName = document.createElement('span');
      homeName.className = 'team-name';
      homeName.textContent = ' ' + g.home;
      homeDiv.appendChild(homeLogo);
      homeDiv.appendChild(homeName);

      row.appendChild(awayDiv);
      row.appendChild(at);
      row.appendChild(homeDiv);
      tdM.appendChild(row);

      // Spread
      const tdS = document.createElement('td');
      const line = (g.spread_frozen ?? g.spread);
      let spreadTxt = '';
      if (line != null && line !== '') {
        const s = Number(line);
        spreadTxt = (s > 0 ? '+' + s : String(s));
      }
      const isFrozen = !!g.spread_is_frozen;
      const badge = document.createElement('span');
      badge.className = 'badge' + (isFrozen ? ' frozen' : '');
      badge.textContent = `DK ${spreadTxt}`;
      tdS.appendChild(badge);

      if (USERNAME === 'Will' && !isFrozen) {
        badge.style.cursor = 'pointer';
        badge.title = 'Click to freeze this line';
        badge.onclick = async () => { await sbFreezeGame(g.id); await render(); };
      }

      // Your Pick
      const tdP = document.createElement('td');
      const selTeam = document.createElement('select');
      selTeam.className = 'select team-select pick-select';

      const phOpt = document.createElement('option');
      phOpt.value = '';
      phOpt.textContent = '‚Äî';
      selTeam.appendChild(phOpt);

      [g.away, g.home].forEach(fullName => {
        const abbr = TEAM_LOGOS[fullName] || fullName.slice(0,3).toUpperCase();
        const o = document.createElement('option');
        o.value = fullName;
        o.dataset.full  = fullName;
        o.dataset.abbr  = abbr;
        o.textContent   = IS_MOBILE.matches ? abbr : fullName;
        selTeam.appendChild(o);
      });

      if (myPicks[g.id]?.team) selTeam.value = myPicks[g.id].team;
      else selTeam.value = '';
      selTeam.disabled = locked;

      selTeam.addEventListener('focus', () => {
        Array.from(selTeam.options).forEach(opt => {
          if (opt.dataset.full) opt.textContent = opt.dataset.full;
        });
      });
      selTeam.addEventListener('blur', () => {
        Array.from(selTeam.options).forEach(opt => {
          if (opt.dataset.abbr && IS_MOBILE.matches) opt.textContent = opt.dataset.abbr;
          else if (opt.dataset.full) opt.textContent = opt.dataset.full;
        });
      });

      function updatePickTint() {
        selTeam.classList.remove('status-won','status-push','status-lost');

        const mp = myPicks[g.id] || {};
        const team = (mp.team ?? selTeam.value ?? '').toString();
        if (!team) return;

        const gameFinal = mp.game_final === true;
        const winnerATS = mp.game_winner_ats;

        if (gameFinal && winnerATS) {
          const isHome = team.toLowerCase() === g.home.toLowerCase();
          const isAway = team.toLowerCase() === g.away.toLowerCase();
          const pickSide = isHome ? 'HOME' : (isAway ? 'AWAY' : 'UNKNOWN');

          if (winnerATS === 'PUSH') selTeam.classList.add('status-push');
          else if (pickSide === winnerATS) selTeam.classList.add('status-won');
          else selTeam.classList.add('status-lost');
          return;
        }

        if (g.home_score == null || g.away_score == null) return;

        const hs = Number(g.home_score);
        const as = Number(g.away_score);
        const line = Number((g.spread_frozen ?? g.spread));
        if (!Number.isFinite(hs) || !Number.isFinite(as) || !Number.isFinite(line)) return;

        const isHome = team.toLowerCase() === g.home.toLowerCase();
        const isAway = team.toLowerCase() === g.away.toLowerCase();
        const pickSide = isHome ? 'HOME' : (isAway ? 'AWAY' : 'UNKNOWN');

        const adjHome = hs + line;
        let leader = 'PUSH';
        if (adjHome > as) leader = 'HOME';
        else if (adjHome < as) leader = 'AWAY';

        if (leader === 'PUSH') selTeam.classList.add('status-push');
        else if (pickSide !== 'UNKNOWN') selTeam.classList.add(pickSide === leader ? 'status-won' : 'status-lost');
      }

      selTeam.onchange = async () => {
        try {
          const confStr = (document.querySelector(`#conf-${g.id}`)?.value ?? '');
          const conf    = confStr === '' ? null : Number(confStr);

          await sbSavePick(CURRENT_WEEK, g.id, selTeam.value || null, conf);

          const prev = myPicks[g.id] || {};
          myPicks[g.id] = {
            team: selTeam.value || null,
            confidence: conf,
            result: prev.result ?? null,
            game_home: prev.game_home ?? g.home,
            game_away: prev.game_away ?? g.away,
            game_final: prev.game_final ?? g.final ?? false,
            game_winner_ats: prev.game_winner_ats ?? g.winner_ats ?? null
          };

          updatePartialBanner();
          updatePickTint();
          showToast('Saved');
          updateDuplicateWarnings();
        } catch (e) {
          console.error('selTeam save failed', e);
        }
      };

      tdP.appendChild(selTeam);
      updatePickTint();

      // Confidence
      const tdC = document.createElement('td');
      const selConf = document.createElement('select');
      selConf.className = 'select conf';
      selConf.id = `conf-${g.id}`;
      selConf.disabled = locked;

      const ph = document.createElement('option');
      ph.value = '';
      ph.textContent = '‚Äî';
      selConf.appendChild(ph);

      const current = myPicks[g.id]?.confidence != null ? Number(myPicks[g.id].confidence) : null;

      const confPoolLocal = localConfValuesForGames(games.length);
      confPoolLocal.forEach(v => {
        const o = document.createElement('option');
        o.value = String(v);
        o.textContent = String(v);
        if (usedConfidence.has(v) && v !== current) o.disabled = true;
        selConf.appendChild(o);
      });

      selConf.value = (current != null ? String(current) : '');

      selConf.onchange = async () => {
        try {
          const hadPrev = (myPicks[g.id]?.confidence != null);
          const prev = hadPrev ? Number(myPicks[g.id].confidence) : null;
          if (hadPrev) usedConfidence.delete(prev);

          const chosenStr = selConf.value;
          const chosen = chosenStr === '' ? null : Number(chosenStr);
          if (chosen != null) usedConfidence.add(chosen);

          const team = (myPicks[g.id]?.team || selTeam.value) || null;

          await sbSavePick(CURRENT_WEEK, g.id, team, chosen);
          myPicks[g.id] = { team, confidence: chosen };

          document.querySelectorAll('select.conf').forEach(s => {
            const curStr = s.value;
            const cur = curStr === '' ? null : Number(curStr);
            for (const opt of s.options) {
              if (opt.value === '') continue;
              const val = Number(opt.value);
              opt.disabled = (usedConfidence.has(val) && val !== cur);
            }
          });

          updatePartialBanner();
          updateDuplicateWarnings();
        } catch (e) {
          console.error('selConf save failed', e);
        }
      };

      tdC.appendChild(selConf);

      tr.appendChild(tdM);
      tr.appendChild(tdS);
      tr.appendChild(tdP);
      tr.appendChild(tdC);
      tbody.appendChild(tr);
    });

    updatePartialBanner();
    setLockedUI(locked);
    updateDuplicateWarnings();
  }

  // -----------------------
  // Partial banner helpers
  // -----------------------
  function calcProgress() {
    const total = games.length;
    let complete = 0, started = 0;
    games.forEach(g => {
      const p = myPicks[g.id] || {};
      const hasTeam = !!p.team;
      const hasConf = (p.confidence != null);
      if (hasTeam || hasConf) started++;
      if (hasTeam && hasConf) complete++;
    });
    return { complete, total, started };
  }

  function updatePartialBanner() {
    const box = document.getElementById('partialWarning');
    const span = document.getElementById('partialCount');
    if (!box || !span) return;
    const { complete, total, started } = calcProgress();
    if (complete === total && total > 0) {
      box.style.display = 'none';
    } else {
      span.textContent = `${complete}/${total} games have both a team and confidence (${started} started).`;
      box.style.display = '';
    }
  }

  function setLockedUI(isLocked) {
    const saveBtn = document.getElementById('savePicksBtn');
    if (saveBtn) {
      if (isLocked) {
        saveBtn.disabled = true;
        saveBtn.textContent = 'Locked';
      } else {
        saveBtn.disabled = false;
        saveBtn.textContent = 'Save Picks';
      }
    }

    document.querySelectorAll('#picks-table select').forEach(sel => {
      sel.disabled = isLocked;
    });

    const bar = document.getElementById('partialWarning');
    if (isLocked) {
      bar.style.display = 'block';
      bar.textContent = 'This week is locked ‚Äî picks cannot be changed.';
    } else {
      updatePartialBanner();
    }
  }

  document.addEventListener('DOMContentLoaded', init);
</script>

<!-- Save/Confirm logic -->
<script>
  function showStatus(msg, isError = false) {
    const el = document.getElementById('saveStatus');
    if (!el) return;
    el.style.display = 'inline';
    el.style.color = isError ? '#ff6b6b' : '#9be49b';
    el.textContent = msg;
  }
  function clearStatus() {
    const el = document.getElementById('saveStatus');
    if (!el) return;
    el.style.display = 'none';
    el.textContent = '';
  }
  function openConfirmModal() {
    document.getElementById('confirmModal').style.display = 'block';
  }
  function closeConfirmModal() {
    document.getElementById('confirmModal').style.display = 'none';
  }

  function getWeekNumber() {
    const el = document.getElementById('week-select');
    return el ? Number(el.value) : NaN;
  }

  function readUserSelections() {
    const rows = Array.from(document.querySelectorAll('tr[data-game-id]'));
    return rows.map(row => {
      const gameId = row.getAttribute('data-game-id');
      const home = row.getAttribute('data-home');
      const away = row.getAttribute('data-away');
      const spreadRaw = row.getAttribute('data-spread');
      const spread = spreadRaw !== null && spreadRaw !== '' ? Number(spreadRaw) : null;

      const teamEl = row.querySelector('.team-select');
      const team = teamEl ? teamEl.value : null;

      const confEl = row.querySelector('select.conf');
      const confStr = confEl ? confEl.value : '';
      const confidence = confStr === '' ? null : Number(confStr);

      return { game_id: gameId, home, away, spread, team, confidence, row, confEl };
    });
  }

  function buildTop5(selections) {
    const sorted = [...selections].sort((a, b) => b.confidence - a.confidence);
    return sorted.slice(0, Math.min(5, selections.length));
  }

  function renderTop5Dialog(selections) {
    const week = getWeekNumber();
    const top5 = buildTop5(selections);

    const summary = document.getElementById('confirmSummary');
    if (summary) {
      const { complete, total, started } = calcProgress();
      summary.innerHTML = `
        <div><strong>Week:</strong> ${week}</div>
        <div><strong>Progress:</strong> ${complete}/${total} complete (${started} started)</div>
        <div><strong>Previewing:</strong> Top 5 of your completed picks</div>
      `;
    }

    const list = document.getElementById('top5List');
    if (list) {
      list.innerHTML = '';
      top5.forEach(item => {
        const opponent = item.team === item.home ? item.away : item.home;
        const vsAt = item.team === item.home ? 'vs' : 'at';
        const spreadTxt = (item.spread === null || Number.isNaN(item.spread))
          ? ''
          : `Spread: ${item.spread > 0 ? '+'+item.spread : item.spread}`;

        const logoTeam = `<img src="logos/${item.team}.png" alt="${item.team}" onerror="this.style.display='none'" style="width:22px;height:22px;border-radius:50%;vertical-align:middle;margin-right:6px;">`;
        const row = document.createElement('div');
        row.style.padding = '8px';
        row.style.borderBottom = '1px solid #222';
        row.innerHTML = `
          <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
            <div style="display:flex; align-items:center;">
              <div style="width:28px; text-align:right; margin-right:8px;"><strong>${item.confidence}</strong></div>
              <div>${logoTeam}<strong>${item.team}</strong> ${vsAt} ${opponent}</div>
            </div>
            <div style="opacity:0.8; font-size:12px; text-align:right;">
              <div>${spreadTxt}</div>
            </div>
          </div>
        `;
        list.appendChild(row);
      });
    }
  }

  let __pendingSelections = null;

  function handleSaveClick() {
    clearStatus();
    const btn = document.getElementById('savePicksBtn');
    btn.disabled = true;
    btn.textContent = 'Preparing‚Ä¶';

    try {
      const selections = readUserSelections();

      selections.forEach(s => {
        myPicks[s.game_id] = { team: s.team, confidence: s.confidence };
      });
      updatePartialBanner();

      __pendingSelections = selections;
      const completeOnly = selections.filter(s => s.team && s.confidence != null);
      renderTop5Dialog(completeOnly);

      openConfirmModal();
    } catch (e) {
      showStatus(String(e), true);
    } finally {
      btn.disabled = false;
      btn.textContent = 'Save Picks';
    }
  }

  async function handleConfirmSave() {
    const btn = document.getElementById('savePicksBtn');
    const confirmBtn = document.getElementById('confirmSaveBtn');
    confirmBtn.disabled = true;
    confirmBtn.textContent = 'Saving‚Ä¶';

    try {
      const week = getWeekNumber();
      const rows = (__pendingSelections || [])
        .filter(s => s.team && s.confidence != null)
        .map(s => ({
          username: localStorage.getItem('username') || (window.CONFIG.USERNAME || 'Will'),
          season: window.CONFIG.SEASON,
          week,
          game_id: s.game_id,
          team: s.team,
          confidence: s.confidence
        }));

      if (rows.length) {
        const { error } = await window.sb
          .from('picks')
          .upsert(rows, { onConflict: 'username,season,week,game_id' });
        if (error) throw new Error(error.message || 'Failed to save picks.');
      }

      closeConfirmModal();
      showStatus(rows.length ? 'Saved!' : 'Nothing to save yet (no completed picks).', false);
      updateDuplicateWarnings();
    } catch (e) {
      showStatus(String(e), true);
    } finally {
      confirmBtn.disabled = false;
      confirmBtn.textContent = 'Confirm';
      btn.disabled = false;
      btn.textContent = 'Save Picks';
    }
  }

  function initSaveFlow() {
    const saveBtn = document.getElementById('savePicksBtn');
    const confirmBtn = document.getElementById('confirmSaveBtn');
    const cancelBtn = document.getElementById('cancelConfirmBtn');

    if (saveBtn) saveBtn.addEventListener('click', handleSaveClick);
    if (confirmBtn) confirmBtn.addEventListener('click', handleConfirmSave);
    if (cancelBtn) cancelBtn.addEventListener('click', closeConfirmModal);
  }
</script>
</body>
</html>
